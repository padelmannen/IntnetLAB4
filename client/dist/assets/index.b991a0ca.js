import{l as b,r as y,o as c,c as l,a as s,b as k,F as m,d as w,e as p,t as h,w as f,f as _,v as g,g as N,h as O,i as S}from"./vendor.d89baaf0.js";const A=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function n(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerpolicy&&(r.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?r.credentials="include":o.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(o){if(o.ep)return;o.ep=!0;const r=n(o);fetch(o.href,r)}};A();var d=(e,t)=>{const n=e.__vccOpts||e;for(const[i,o]of t)n[i]=o;return n};const L={name:"App",components:{},data:()=>({socket:b().connect()}),created(){const{commit:e}=this.$store,{push:t}=this.$router;fetch("/api/users/me").then(n=>n.json()).then(({authenticated:n})=>{e("setAuthenticated",n),t(n===!0?"/rooms":"/login")}).catch(console.error)},methods:{redirect(e){this.$router.push(e)}}},x={class:"navbar navbar-expand-md navbar-dark bg-dark"},C=s("button",{class:"navbar-toggler mx-2 mb-2",type:"button","data-bs-toggle":"collapse","data-bs-target":"#navbarNav"},[s("span",{class:"navbar-toggler-icon"})],-1),R={id:"navbarNav",class:"collapse navbar-collapse mx-2"},V={class:"navbar-nav"},j={class:"nav-item"},T={class:"nav-item"},E={class:"container-fluid py-4"};function P(e,t,n,i,o,r){const a=y("router-view");return c(),l(m,null,[s("nav",x,[C,s("div",R,[s("ul",V,[s("li",j,[s("a",{class:"nav-link",href:"#",onClick:t[0]||(t[0]=u=>r.redirect("/login"))},"Login")]),s("li",T,[s("a",{class:"nav-link",href:"#",onClick:t[1]||(t[1]=u=>r.redirect("/rooms"))},"Rooms")])])])]),s("section",E,[k(a)])],64)}var q=d(L,[["render",P]]),v=w({state:{authenticated:!1},getters:{isAuthenticated(e){return e.authenticated}},mutations:{setAuthenticated(e,t){e.authenticated=t}},actions:{},modules:{}});const B={name:"RoomsView",components:{},data:()=>({rooms:[]}),created(){fetch("/api/rooms").then(e=>e.json()).then(({rooms:e})=>{this.rooms=e}).catch(console.error)},methods:{redirect(e){this.$router.push(`/rooms/${e}`)}}},D={class:"row"},F=s("div",{class:"col"},null,-1),M={class:"col list-group"},U=["onClick"],J=s("div",{class:"col"},null,-1);function K(e,t,n,i,o,r){return c(),l("div",D,[F,s("div",M,[(c(!0),l(m,null,p(e.rooms,a=>(c(),l("button",{key:a.name,type:"button",class:"list-group-item list-group-item-action my-2 py-2",onClick:u=>r.redirect(a.name)},h(a.name),9,U))),128))]),J])}var W=d(B,[["render",K]]);const H={name:"RoomView",components:{},data(){return{name:this.$route.params.name,messages:[],message:""}},async created(){const e=await fetch(`/api/rooms/${this.name}/messages`),{messages:t}=await e.json();this.messages=t;const{socket:n}=this.$root;n.on("msg",i=>{this.messages=[...this.messages,i]})},methods:{send(){fetch(`/api/rooms/${this.name}/messages`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:this.message})}).catch(console.error),this.message=""}}},I={class:"row"},Y=s("div",{class:"col-3"},null,-1),z={class:"col-6 list-group"},G=s("button",{type:"submit",class:"btn btn-dark mt-4 float-end"},"SEND",-1),Q=s("div",{class:"col-3"},null,-1);function X(e,t,n,i,o,r){return c(),l("div",I,[Y,s("ul",z,[(c(!0),l(m,null,p(o.messages,(a,u)=>(c(),l("li",{key:u,type:"button",class:"list-group-item py-1"},h(a),1))),128)),s("form",{onSubmit:t[1]||(t[1]=f(a=>r.send(),["prevent"]))},[_(s("input",{id:"message","onUpdate:modelValue":t[0]||(t[0]=a=>o.message=a),type:"text",class:"form-control form-control-sm",placeholder:"message...",required:"",autofocus:""},null,512),[[g,o.message]]),G],32)]),Q])}var Z=d(H,[["render",X]]);const ee={name:"LoginView",components:{},data:()=>({username:""}),methods:{authenticate(){const{commit:e}=this.$store,{push:t}=this.$router;fetch("/api/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:this.username})}).then(n=>n.json()).then(({authenticated:n})=>{e("setAuthenticated",n),t(n===!0?"/rooms":"/login")}).catch(console.error)}}},te={class:"row"},se=s("div",{class:"col"},null,-1),oe=s("label",{for:"username",class:"form-label h4"},"What is Your name?",-1),ne=s("button",{type:"submit",class:"btn btn-dark mt-4 float-end"},"OK",-1),re=s("div",{class:"col"},null,-1);function ae(e,t,n,i,o,r){return c(),l("div",te,[se,s("form",{class:"col",onSubmit:t[1]||(t[1]=f(a=>r.authenticate(),["prevent"]))},[oe,_(s("input",{id:"username","onUpdate:modelValue":t[0]||(t[0]=a=>e.username=a),type:"text",class:"form-control",placeholder:"username...",required:"",autofocus:""},null,512),[[g,e.username]]),ne],32),re])}var ie=d(ee,[["render",ae]]);const ce=[{path:"/",redirect:"/rooms"},{path:"/rooms",component:W},{path:"/rooms/:name",component:Z},{path:"/login",component:ie}],$=N({history:O("/"),routes:ce});$.beforeEach((e,t,n)=>{v.state.authenticated||e.path==="/login"?n():(console.info("Unauthenticated user. Redirecting to login page."),n("/login"))});S(q).use(v).use($).mount("#app");
